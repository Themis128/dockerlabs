echo "ğŸ” Running pre-commit checks..."

# Generate Nuxt types first (required for auto-imports)
echo "Generating Nuxt types..."
npx nuxi prepare --skip-build || {
  echo "âš ï¸  Warning: Failed to generate Nuxt types, skipping TypeScript check"
}

# Check TypeScript syntax (only if Nuxt types are available)
if [ -d ".nuxt" ]; then
  echo "Checking TypeScript..."
  npx tsc --noEmit --skipLibCheck || {
    echo "âŒ TypeScript check failed"
    echo "ğŸ’¡ Tip: Run 'npm run dev' once to generate Nuxt types, then try again"
    exit 1
  }
else
  echo "âš ï¸  Skipping TypeScript check (Nuxt types not generated)"
  echo "ğŸ’¡ Tip: Run 'npm run dev' once to generate Nuxt types"
fi

# Check Python syntax
echo "Checking Python syntax..."
python -m py_compile web-gui/server.py || {
  echo "âŒ Python syntax check failed"
  exit 1
}

# Check for common issues
echo "Checking for common issues..."
if git diff --cached --name-only | grep -q "\.json$"; then
  echo "Validating JSON files..."
  git diff --cached --name-only | grep "\.json$" | while read file; do
    python -m json.tool "$file" > /dev/null || {
      echo "âŒ Invalid JSON: $file"
      exit 1
    }
  done
fi

echo "âœ… Pre-commit checks passed"
